<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>프로필</title>
</head>
<body>
  <h2>프로필</h2>
  <div>
    <b>닉네임:</b> {{ user.nickname or user.user_id }}<br>
    <b>이메일:</b> {{ user.email }}<br>
    <b>가입일:</b> {{ created_at }}<br>
    <!-- 친구추가/삭제 버튼 제거 -->
    {% if current_user_id and user.user_id != current_user_id %}
      <!-- 차단/차단 해제 버튼 -->
      {% if not is_blocked %}
        <button id="blockUserBtn" onclick="blockUser()">차단하기</button>
        <span id="blockStatus"></span>
      {% else %}
        <button id="unblockUserBtn" onclick="unblockUser()">차단 해제하기</button>
        <span id="unblockStatus"></span>
      {% endif %}
    {% endif %}
    {% if current_user_id and user.user_id == current_user_id %}
      <!-- 본인 프로필에서는 차단 버튼 숨김 -->
    {% endif %}
  </div>
  <h3>친구 목록</h3>
  <ul>
    {% for friend in friends %}
      <li>{{ friend.nickname }} ({{ friend.email }})</li>
    {% else %}
      <li>친구가 없습니다.</li>
    {% endfor %}
  </ul>
  <h3>게시물</h3>
  {% for post in posts %}
    <div style="border:1px solid #ccc;margin:8px;padding:8px;">
      <span>{{ post.created_at }}</span><br>
      <span>{{ post.content }}</span>
    </div>
  {% else %}
    <div>게시물이 없습니다.</div>
  {% endfor %}
  <a href="/community">← 커뮤니티로 돌아가기</a>
  <script>
    async function blockUser() {
      const jwt = localStorage.getItem('jwt');
      if (!jwt) {
        alert('로그인 필요');
        return;
      }
      const userId = "{{ user.user_id }}";
      if ("{{ current_user_id }}" === userId) {
        alert('자기 자신은 차단할 수 없습니다.');
        return;
      }
      const res = await fetch(`/community/block_user`, {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + jwt, 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: userId })
      });
      if (res.ok) {
        document.getElementById('blockStatus').textContent = '계정 차단 완료!';
        document.getElementById('blockUserBtn').disabled = true;
        location.reload();
      } else {
        document.getElementById('blockStatus').textContent = '차단 실패!';
      }
    }

    async function unblockUser() {
      const jwt = localStorage.getItem('jwt');
      if (!jwt) {
        alert('로그인 필요');
        return;
      }
      const userId = "{{ user.user_id }}";
      const res = await fetch(`/community/unblock_user`, {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + jwt, 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: userId })
      });
      if (res.ok) {
        document.getElementById('unblockStatus').textContent = '차단 해제 완료!';
        document.getElementById('unblockUserBtn').disabled = true;
        location.reload();
      } else {
        document.getElementById('unblockStatus').textContent = '차단 해제 실패!';
      }
    }
  </script>
</body>
</html>